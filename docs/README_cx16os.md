# Commander X16 / OtterX running cx16os

If you install an 65C816 (or an [OtterX cpu switcher](https://www.tindie.com/products/wavicle/65xx-cpu-switcher-for-otterx-and-x16/)) in your Commander X16 or OtterX, you can run cx16os.

With cx16os you get a terminal based multitasking os with some Unix like features.
While cx16os requires a 65C816, the Prog8 compiler support is limited to the 65C02 emulation mode.
Prog8 does support inline assembler and the 64tass assembler supports 65C816 code.
As a result you can support 65C816 functionality via assembler and use an inline assembler
layer to support any calls that can't work in emulation mode.

The examples here just use 65C02 code as generated by the Prog8 compiler, but are not
particularly advanced.  They are meant to demonstrate the basic functionality.  They
do work fine without any special 65C816 handling.

The cx16os target is defined in the file `config/cx16os.properties` and there is also the file
`config/cx16os.24kb_properties` which is meant to support the larger memory mode (still 65C02)
but is still very preliminary.


## Building / Running for cx16os

Use the `Makefile` (by running `make`) if you can and it will generate `build/hello_cx16os.prg`, `build/arch.prg`, `build/pwd.prg`, and `build/uname.prg`.  These last three provide output
similar to Unix commands of the same name.

To build manually you just need to specify the custom target file for `prog8c` to build the binary.

```
prog8c -target config/cx16os.properties -out build/ -asmlist src/hello_cx16os.p8
prog8c -target config/cx16os.properties -out build/ -asmlist src/arch.p8
prog8c -target config/cx16os.properties -out build/ -asmlist src/pwd.p8
prog8c -target config/cx16os.properties -out build/ -asmlist src/uname.p8
```

The resulting files can be copied into your cx16os installation directory under bin.
For example under Linux or macOS you might use `cp build/uname.prg OS/bin/uname` if
you have an installation of cx16os in the `OS` directory.

To use the simple cx16os examples just run `make` and they will be in build/.
If you download the latest cx16os and unzip it here you will have an `OS` directory.
You can then use the command line below to boot cx16os.

`x16emu -debug -quality best -scale 2 -rtc -c816 -nvram nvram.bin -fsroot OS/`

### Running cx16os examples

Included in the examples are `arch`, `hello`, `pwd` (I name it `pwd8` to test it), and `uname`.
These are like their Linux/Unix counterparts except `hello` which just prints a "Hello World" style
message.

The `uname` command takes various arguments and prints information about the system.  Try `uname -a` to get all of the information available.

Arguments:
```
    -a all available info
    -b total banks / memory
    -i hardware platform
    -k kernal version
    -m architecture
    -o operating system
    -p architecture
    -r kernal version
    -s SMC version
    -v VERA version
```

## cx16os libraries

This is currently just copies of a few Commander X16 native libraries with very minor adjustments. These will be slowly converted over to support cx16os API calls more fully.

Just minimal chrout / chrin support is working for cx16os.  That allows a lot of the textio library to work, at least partially.

## cx16os "include" files

Currently there is `os.p8` which defines various cx16os api calls as `extsub` stubs.
These will get arguments and return values added as the functions are used / needed.



